# Graph Merger Tool

Combines backend and frontend architecture graphs into a unified baseline, detecting inconsistencies between layers.

## Usage

```bash
# Generate default output (tools/graph/graph-baseline.json)
python3 tools/graph/merge-graph.py

# Generate to custom output file
python3 tools/graph/merge-graph.py --output /path/to/custom-baseline.json
```

## Input Files

- `tools/graph/backend-graph.json` - Generated by `generate-backend.py`
- `tools/graph/frontend-graph.json` - Generated by `generate-frontend.js`

## Output Files

- `tools/graph/graph-baseline.json` - Unified merged graph (default)
- Custom path via `--output` parameter

## What It Does

### 1. Merges Both Graphs
Combines all nodes from backend (entities, DTOs, services, controllers) and frontend (types, api_functions, hooks, components) into a single graph structure.

### 2. Creates Cross-Layer Mappings
Links frontend types to backend DTOs by matching names:
- `PersonDto` → `PersonDetailDto` 
- `FamilyDto` → `FamilyDetailDto`
- Handles naming variations automatically

### 3. Detects Inconsistencies
Reports mismatches between layers:

- **DTOs without frontend types** - Backend DTOs that have no corresponding frontend type
- **Types without backend DTOs** - Frontend types without a matching backend DTO
- **Property mismatches** - Properties in backend DTOs not present in frontend types
- **Missing endpoint coverage** - Backend API endpoints without corresponding frontend API functions

## Output Structure

```json
{
  "version": "1.0",
  "generated_at": "ISO timestamp",
  "entities": {...},
  "dtos": {...},
  "services": {...},
  "controllers": {...},
  "hooks": {...},
  "api_functions": {...},
  "components": {...},
  "edges": [...],
  "cross_layer_mappings": {
    "dto:PersonDto": "type:PersonDetailDto",
    ...
  },
  "stats": {
    "entities": 41,
    "dtos": 77,
    "types": 109,
    ...
  }
}
```

## Inconsistency Report

The tool prints a detailed report to stdout showing:

```
DTOs without frontend types (X):
  - SomeDtoName
  - AnotherDtoName

Frontend types without backend DTOs (Y):
  - SomeTypeName
  - AnotherTypeName

Property mismatches (Z):
  - PersonDto.firstName vs PersonDetailDto.first_name

Backend endpoints without frontend API functions (N):
  - GET api/v1/people/{idKey}
  - POST api/v1/groups
```

## Exit Codes

- `0` - Success
- `1` - Error (missing files, invalid JSON, write failure)

## How to Integrate

Add to your CI/CD pipeline:

```bash
# Validate graph after code generation
python3 tools/graph/merge-graph.py

# Check for inconsistencies (exit code is reliable)
if [ $? -eq 0 ]; then
  echo "Graph merge successful"
else
  echo "Graph merge failed"
  exit 1
fi
```

## Token Efficiency

This script uses only Python stdlib (json, os, sys, pathlib) with no external dependencies, making it fast and lightweight.

## Notes

- Property comparisons convert C# PascalCase to TypeScript camelCase automatically
- Route parameter matching handles variations like `{idKey}`, `{id}`, `{param}`
- Many DTOs deliberately omit frontend types (they're internal/analytics DTOs)
- Many frontend types don't need backend DTOs (helpers, enums, request objects)
